global.handler.fragmentsHandler.config {
  tasks {
    tags-listing {
      action = tags-with-cb
      onTransitions {
        _success {
          action = te
        }
        _error {
          action = tags-fallback
        }
      }
    }
    authors-listing {
      action = author
      onTransitions {
        _success {
          action = te
        }
      }
    }
    books-and-authors-listing {
      actions = [
        {
          action = book
        },
        {
          action = author
        }
      ]
      onTransitions {
        _success {
          action = te
        }
      }
    }
  }

  actions {
    tags-with-cb {
      factory = cb
      config {
        circuitBreakerName = "tags service"
        circuitBreakerOptions {
          timeout = 1000
          maxFailures = 1
          resetTimeout = 10000
        }
      }
      doAction = tags
    }
    tags {
      factory = http
      config {
        endpointOptions {
          path = /service/mock/delayed
          domain = localhost
          port = ${test.random.delayedService.port}
          allowedRequestHeaders = [ "Content-Type" ]
        }
      }
    }
    tags-fallback {
      factory = inline-body
      config {
        body = """<p>Tags are unavailable at the moment</p>"""
      }
    }
    book {
      factory = http
      config {
        endpointOptions {
          path = /service/mock/book.json
          domain = localhost
          port = ${test.wiremock.mockService.port}
          allowedRequestHeaders = ["Content-Type"]
        }
      }
    }
    author {
      factory = http
      config {
        endpointOptions {
          path = /service/mock/author.json
          domain = localhost
          port = ${test.wiremock.mockService.port}
          allowedRequestHeaders = [ "Content-Type" ]
        }
      }
    }
    te {
      factory = "knot"
      config {
        address = "knotx.knot.te"
        deliveryOptions {
          sendTimeout = 3000
        }
      }
    }
  }
}